!function(n){function e(n){return String(null===n||void 0===n?"":n)}function r(n){return e(n).replace(h,function(n){return s[n]})}var o={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",propertyToDisplay:"name",jsonContainer:null,contentType:"json",excludeCurrent:!1,excludeCurrentParameter:"x",prePopulate:null,processPrePopulate:!1,hintText:"输入文字可搜索",noResultsText:"无搜索结果",searchingText:"Searching...",deleteText:"&#215;",animateDropdown:!0,placeholder:null,theme:null,zindex:9999,resultsLimit:null,enableHTML:!1,resultsFormatter:function(n){var t=n[this.propertyToDisplay];return"<li>"+(this.enableHTML?t:r(t))+"<\/li>"},tokenFormatter:function(n){var t=n[this.propertyToDisplay];return"<li><p class='group_item_name'>"+(this.enableHTML?t:r(t))+"<\/p><\/li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",allowFreeTagging:!1,allowTabOut:!1,autoSelectFirstResult:!1,onResult:null,onCachedResult:null,onAdd:null,onFreeTaggingAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:!1},u={tokenList:"token-input-list input_text",token:"token-input-token group_item",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token  group_item_close",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown memberDialog_selectTree",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled"},i={BEFORE:0,AFTER:1,END:2},t={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188},s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},h=/[&<>"'\/]/g,f={init:function(t,i){var r=n.extend({},o,i||{});return this.each(function(){n(this).data("settings",r);n(this).data("tokenInputObject",new n.TokenList(this,t,r))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(n){return this.data("tokenInputObject").add(n),this},remove:function(n){return this.data("tokenInputObject").remove(n),this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(n){return this.data("tokenInputObject").toggleDisabled(n),this},setOptions:function(t){return n(this).data("settings",n.extend({},n(this).data("settings"),t||{})),this},destroy:function(){if(this.data("tokenInputObject")){this.data("tokenInputObject").destroy();var n=this,t=this.parent();return t.empty(),n.show(),t.append(n),n}}};n.fn.tokenInput=function(n){return f[n]?f[n].apply(this,Array.prototype.slice.call(arguments,1)):f.init.apply(this,arguments)};n.TokenList=function(f,e,o){function rt(t){return n(f).data("settings").enableHTML?t:r(t)}function wt(t){n(f).data("settings").disabled="boolean"==typeof t?t:!n(f).data("settings").disabled;s.attr("disabled",n(f).data("settings").disabled);l.toggleClass(n(f).data("settings").classes.disabled,n(f).data("settings").disabled);h&&b(n(h),i.END);c.attr("disabled",n(f).data("settings").disabled)}function bt(){if(null!==n(f).data("settings").tokenLimit&&w>=n(f).data("settings").tokenLimit)return(s.hide(),void v())}function kt(){if(at!==(at=s.val())){var n=l.width()-s.offset().left-l.offset().left;ei.html(r(at)||r(o.placeholder));s.width(Math.min(l.width(),Math.max(n,ei.width()+30)))}}function dt(){var t=n.trim(s.val()),i=t.split(n(f).data("settings").tokenDelimiter);n.each(i,function(t,i){if(i){n.isFunction(n(f).data("settings").onFreeTaggingAdd)&&(i=n(f).data("settings").onFreeTaggingAdd.call(c,i));var r={};r[n(f).data("settings").tokenValue]=r[n(f).data("settings").propertyToDisplay]=i;ut(r)}})}function gt(t){var i=n(n(f).data("settings").tokenFormatter(t)),r=t.readonly===!0?!0:!1,u;return r&&i.addClass(n(f).data("settings").classes.tokenReadOnly),i.addClass(n(f).data("settings").classes.token).insertBefore(k),r||n("<span>").addClass(n(f).data("settings").classes.tokenDelete).appendTo(i).click(function(){if(!n(f).data("settings").disabled)return(et(n(this).parent()),c.change(),!1)}),u=t,n.data(i.get(0),"tokeninput",t),y=y.slice(0,p).concat([u]).concat(y.slice(p)),p++,ni(y,c),w+=1,null!==n(f).data("settings").tokenLimit&&w>=n(f).data("settings").tokenLimit&&(s.hide(),v()),i}function ut(t){var r=n(f).data("settings").onAdd,i;w>0&&n(f).data("settings").preventDuplicates&&(i=null,l.children().each(function(){var r=n(this),u=n.data(r.get(0),"tokeninput");if(u&&u[o.tokenValue]===t[o.tokenValue])return(i=r,!1)}),i)||(s.width(1),(null==n(f).data("settings").tokenLimit||w<n(f).data("settings").tokenLimit)&&(gt(t),s.attr("placeholder",null),bt()),s.val(""),v(),n.isFunction(r)&&r.call(c,t))}function ft(t){n(f).data("settings").disabled||(t.addClass(n(f).data("settings").classes.selectedToken),h=t.get(0),s.val(""),v())}function b(t,r){t.removeClass(n(f).data("settings").classes.selectedToken);h=null;r===i.BEFORE?(k.insertBefore(t),p--):r===i.AFTER?(k.insertAfter(t),p++):(k.appendTo(l),p=w);g(s)}function si(t){var r=h;h&&b(n(h),i.END);r===t.get(0)?b(t,i.END):ft(t)}function et(t){var u=n.data(t.get(0),"tokeninput"),r=n(f).data("settings").onDelete,i=t.prevAll().length;i>p&&i--;t.remove();h=null;g(s);y=y.slice(0,i).concat(y.slice(i+1));0==y.length&&(s.attr("placeholder",o.placeholder),s.css("width","auto"));p>i&&p--;ni(y,c);w-=1;null!==n(f).data("settings").tokenLimit&&(s.show().val(""),g(s));n.isFunction(r)&&r.call(c,u)}function ni(t,i){var r=n.map(t,function(t){return"function"==typeof n(f).data("settings").tokenValue?n(f).data("settings").tokenValue.call(this,t):t[n(f).data("settings").tokenValue]});i.val(r.join(n(f).data("settings").tokenDelimiter))}function v(){d.hide();a=null}function hi(){d.css({position:"absolute",top:l.offset().top+l.outerHeight(!0)-1,left:l.offset().left,width:l.innerWidth(),"z-index":n(f).data("settings").zindex}).show()}function st(t){d.children("div").each(function(i,r){t.get(0)==r&&n(this).show()||n(this).hide()})}

function it(){
n(f).data("settings").hintText
&&
("string"===n.type(n(f).data("settings").hintText)
?pt.html("<p>"+rt(n(f).data("settings").hintText)+"<\/p>"):
"function"===n.type(n(f).data("settings").hintText)&&n(f).data("settings").hintText(pt),st(pt),hi())}
 
 

function ci(){n(f).data("settings").searchingText&&(fi.html("<p>"+rt(n(f).data("settings").searchingText)+"<\/p>"),st(fi))}function ti(){st(nt)}function ii(n){return n.replace(oi,"\\$&")}function li(n,t){return n.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+ii(t)+")(?![^<>]*>)(?![^&;]+;)","gi"),function(n,t){return"<b>"+rt(t)+"<\/b>"})}function ai(n,t,i){return n.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+ii(t)+")(?![^<>]*>)(?![^&;]+;)","g"),li(t,i))}function vi(t){if(n(f).data("settings").excludeCurrent){var i=n(f).data("tokenInputObject").getTokens(),r=[];i.length&&(n.each(t,function(t,u){var e=!0;n.each(i,function(t,i){if(u[n(f).data("settings").propertyToDisplay]==i[n(f).data("settings").propertyToDisplay])return(e=!1,!1)});e&&r.push(u)}),t=r)}return t}function ht(t,i){if(i=vi(i),i&&i.length){nt.empty();var r=n("<ul/>").appendTo(nt).mouseover(function(t){ct(n(t.target).closest("li"))}).mousedown(function(t){return ut(n(t.target).closest("li").data("tokeninput")),c.change(),!1}).hide();n(f).data("settings").resultsLimit&&i.length>n(f).data("settings").resultsLimit&&(i=i.slice(0,n(f).data("settings").resultsLimit));n.each(i,function(i,u){var e=n(f).data("settings").resultsFormatter(u);e=ai(e,u[n(f).data("settings").propertyToDisplay],t);e=n(e).appendTo(r);e.addClass(i%2?n(f).data("settings").classes.dropdownItem:n(f).data("settings").classes.dropdownItem2);0===i&&n(f).data("settings").autoSelectFirstResult&&ct(e);n.data(e.get(0),"tokeninput",u)});ti();n(f).data("settings").animateDropdown?r.slideDown("fast"):r.show()}else n(f).data("settings").noResultsText&&(nt.html("<p>"+rt(n(f).data("settings").noResultsText)+"<\/p>"),ti())}function ct(t){t&&(a&&yi(n(a)),t.addClass(n(f).data("settings").classes.selectedDropdownItem),a=t.get(0))}function yi(t){t.removeClass(n(f).data("settings").classes.selectedDropdownItem);a=null}function ri(){var t=s.val();t&&t.length&&(h&&b(n(h),i.AFTER),t.length>=n(f).data("settings").minChars?(ci(),clearTimeout(ui),ui=setTimeout(function(){pi(t)},n(f).data("settings").searchDelay)):v())}function pi(t){var h=t+lt(),u=vt.get(h),e,i,l,a,v,y,r;u?(n.isFunction(n(f).data("settings").onCachedResult)&&(u=n(f).data("settings").onCachedResult.call(c,u)),ht(t,u)):n(f).data("settings").url?(e=lt(),i={},(i.data={},e.indexOf("?")>-1)?(l=e.split("?"),i.url=l[0],a=l[1].split("&"),n.each(a,function(n,t){var r=t.split("=");i.data[r[0]]=r[1]})):i.url=e,(i.data[n(f).data("settings").queryParam]=t,i.type=n(f).data("settings").method,i.dataType=n(f).data("settings").contentType,n(f).data("settings").crossDomain&&(i.dataType="jsonp"),n(f).data("settings").excludeCurrent)&&(v=n(f).data("tokenInputObject").getTokens(),y=n.map(v,function(t){return"function"==typeof n(f).data("settings").tokenValue?n(f).data("settings").tokenValue.call(this,t):t[n(f).data("settings").tokenValue]}),i.data[n(f).data("settings").excludeCurrentParameter]=y.join(n(f).data("settings").tokenDelimiter)),i.success=function(i){vt.add(h,n(f).data("settings").jsonContainer?i[n(f).data("settings").jsonContainer]:i);n.isFunction(n(f).data("settings").onResult)&&(i=n(f).data("settings").onResult.call(c,i));s.val()===t&&ht(t,n(f).data("settings").jsonContainer?i[n(f).data("settings").jsonContainer]:i)},o.onSend&&o.onSend(i),n.ajax(i)):n(f).data("settings").local_data&&(r=n.grep(n(f).data("settings").local_data,function(i){var r=i[n(f).data("settings").propertyToSearch],u;return n.isArray(r)?(u=!1,n.each(r,function(n,i){if(i.toLowerCase().indexOf(t.toLowerCase())>-1)return(u=!0,!1)}),u):r.toLowerCase().indexOf(t.toLowerCase())>-1}),vt.add(h,r),n.isFunction(n(f).data("settings").onResult)&&(r=n(f).data("settings").onResult.call(c,r)),ht(t,r))}function lt(){var t=n(f).data("settings").url;return"function"==typeof n(f).data("settings").url&&(t=n(f).data("settings").url.call(n(f).data("settings"))),t}function g(n){setTimeout(function(){n.focus()},50)}var ot,tt,oi;"string"==typeof e||"function"==typeof e?(n(f).data("settings").url=e,ot=lt(),void 0===n(f).data("settings").crossDomain&&"string"==typeof ot&&(n(f).data("settings").crossDomain=-1===ot.indexOf("://")?!1:location.href.split(/\/+/g)[1]!==ot.split(/\/+/g)[1])):"object"==typeof e&&(n(f).data("settings").local_data=e);n(f).data("settings").classes?n(f).data("settings").classes=n.extend({},u,n(f).data("settings").classes):n(f).data("settings").theme?(n(f).data("settings").classes={},n.each(u,function(t,i){n(f).data("settings").classes[t]=i+"-"+n(f).data("settings").theme})):n(f).data("settings").classes=u;var ui,at,y=[],w=0,vt=new n.TokenList.Cache,s=n('<input type="text" class="input_group_add" autocomplete="off" autocapitalize="off"/>').css({outline:"none"}).attr("id",n(f).data("settings").idPrefix+f.id).focus(function(){return n(f).data("settings").disabled?!1:((null===n(f).data("settings").tokenLimit||n(f).data("settings").tokenLimit!==w)&&it(),void l.addClass(n(f).data("settings").classes.focused))}).blur(function(){yt?g(s):v();n(f).data("settings").allowFreeTagging&&dt();n(this).val("");l.removeClass(n(f).data("settings").classes.focused)}).bind("keydown keydown blur update",kt).keydown(function(r){var u,o,e;switch(r.keyCode){case t.LEFT:case t.RIGHT:case t.UP:case t.DOWN:0===this.value.length?(u=k.prev(),o=k.next(),u.length&&u.get(0)===h||o.length&&o.get(0)===h?r.keyCode===t.LEFT||r.keyCode===t.UP?b(n(h),i.BEFORE):b(n(h),i.AFTER):r.keyCode!==t.LEFT&&r.keyCode!==t.UP||!u.length?r.keyCode!==t.RIGHT&&r.keyCode!==t.DOWN||!o.length||ft(n(o.get(0))):ft(n(u.get(0)))):(e=null,r.keyCode===t.DOWN||r.keyCode===t.RIGHT?(e=n(nt).find("li").first(),a&&(e=n(a).next())):(e=n(nt).find("li").last(),a&&(e=n(a).prev())),ct(e));break;case t.BACKSPACE:if(u=k.prev(),0===this.value.length)return h?n(h).hasClass(n(f).data("settings").classes.tokenReadOnly)||(et(n(h)),c.change()):u.length?ft(n(u.get(0))):(v(),it()),!1;1===this.value.length?(v(),it()):setTimeout(function(){ri()},5);break;case t.TAB:case t.ENTER:case t.NUMPAD_ENTER:case t.COMMA:if(a)ut(n(a).data("tokeninput")),c.change(),it();else{if(n(f).data("settings").allowFreeTagging){if(n(f).data("settings").allowTabOut&&""===n(this).val())return!0;dt()}else if(n(this).val(""),n(f).data("settings").allowTabOut)return!0;r.stopPropagation();r.preventDefault()}return!1;case t.ESCAPE:return v(),!0;default:0===this.value.length&&(v(),it());String.fromCharCode(r.which)&&setTimeout(function(){ri()},5)}});o.placeholder&&s.attr("placeholder",o.placeholder);var c=n(f).hide().val("").focus(function(){g(s)}).blur(function(){return s.blur(),c}),h=null,p=0,a=null,l=n("<ul />").addClass(n(f).data("settings").classes.tokenList).click(function(t){var r=n(t.target).closest("li");r&&r.get(0)&&n.data(r.get(0),"tokeninput")?si(r):(h&&b(n(h),i.END),g(s))}).mouseover(function(t){var i=n(t.target).closest("li");i&&h!==this&&i.addClass(n(f).data("settings").classes.highlightedToken)}).mouseout(function(t){var i=n(t.target).closest("li");i&&h!==this&&i.removeClass(n(f).data("settings").classes.highlightedToken)}).insertBefore(c),k=n("<li />").addClass(n(f).data("settings").classes.inputToken).appendTo(l).append(s),yt=!1,d=n("<div/>").addClass(n(f).data("settings").classes.dropdown).appendTo("body").hide().mousemove(function(){yt=!0}).mouseout(function(){yt=!1}),pt=n("<div id='token-input-dropdown-hint'/>").appendTo(d).hide(),fi=n("<div id='token-input-dropdown-searching'/>").appendTo(d).hide(),nt=n("<div id='token-input-dropdown-result'/>").appendTo(d).hide(),ei=n("<tester/>").insertAfter(s).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:s.css("fontSize"),fontFamily:s.css("fontFamily"),fontWeight:s.css("fontWeight"),letterSpacing:s.css("letterSpacing"),whiteSpace:"nowrap"});c.val("");tt=n(f).data("settings").prePopulate||c.data("pre");n(f).data("settings").processPrePopulate&&n.isFunction(n(f).data("settings").onResult)&&(tt=n(f).data("settings").onResult.call(c,tt));tt&&tt.length&&n.each(tt,function(n,t){gt(t);bt();s.attr("placeholder",null)});n(f).data("settings").disabled&&wt(!0);"function"==typeof n(f).data("settings").onReady&&n(f).data("settings").onReady.call();this.clear=function(){l.children("li").each(function(){0===n(this).children("input").length&&et(n(this))})};this.add=function(n){ut(n)};this.remove=function(t){l.children("li").each(function(){var u,i,r;if(0===n(this).children("input").length){u=n(this).data("tokeninput");i=!0;for(r in t)if(t[r]!==u[r]){i=!1;break}i&&et(n(this))}})};this.getTokens=function(){return y};this.toggleDisabled=function(n){wt(n)};this.destroy=function(){this.clear();d.remove()};kt();oi=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g")};n.TokenList.Cache=function(t){var u,f,i={},r=0;u=n.extend({max_size:500},t);f=function(){i={};r=0};this.add=function(n,t){r>u.max_size&&f();i[n]||(r+=1);i[n]=t};this.get=function(n){return i[n]}}}(jQuery);